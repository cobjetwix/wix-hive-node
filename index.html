<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Wix openapi-node Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Wix openapi-node</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="API.html">Wix/API</a>
						</li>
						
						<li>
							<a href="connect.html">wix/connect</a>
						</li>
						
						<li>
							<a href="Connect_.html">Wix/Connect</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Activities.html">Activities</a>
						</li>
						
						<li>
							<a href="ActivityType.html">ActivityType</a>
						</li>
						
						<li>
							<a href="APIBuilder.html">APIBuilder</a>
						</li>
						
						<li>
							<a href="BaseWixAPIObject.html">BaseWixAPIObject</a>
						</li>
						
						<li>
							<a href="Contact.html">Contact</a>
						</li>
						
						<li>
							<a href="Contacts.html">Contacts</a>
						</li>
						
						<li>
							<a href="Insights.html">Insights</a>
						</li>
						
						<li>
							<a href="Wix.html">Wix</a>
						</li>
						
						<li>
							<a href="WixActivity.html">WixActivity</a>
						</li>
						
						<li>
							<a href="WixActivityData.html">WixActivityData</a>
						</li>
						
						<li>
							<a href="WixAPICaller.html">WixAPICaller</a>
						</li>
						
						<li>
							<a href="WixPagingData.html">WixPagingData</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#ContactFormSchema">ContactFormSchema</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
		<div class="span8">
			
				<div id="main">
					


	
	<span class="page-title">Index</span>
	
	












	
	





    <section>
        <article><h1>Wix-Hive-Node</h1>
<h1>Node library to work with the the Wix RESTful API.</h1>
<p>Read about <a href="http://dev.wix.com/docs/display/DRAF/Third+Party+Apps+-+Introduction">developing a third party app for the Wix platform</a>.</p>
<h2>Prerequisites</h2>
<ul>
<li><strong>Register your app</strong> <a href="http://dev.wix.com/docs/display/DRAF/Dev+Center+Registration+Guide">here</a> to <strong>obtain</strong> your <strong>APP_KEY</strong> and <strong>APP_SECRET</strong></li>
<li><strong>Get the Javascript SDK</strong> <a href="http://dev.wix.com/docs/display/DRAF/JavaScript+SDK">here</a>. You'll need it for any data altering API calls (such as creating an activity).</li>
</ul>
<h2>Installation</h2>
<p>Install <a href="https://www.npmjs.org/doc/README.html">npm</a>, then install the package:</p>
<pre><code class="lang-js">$ npm install openapi-node</code></pre>
<h2>API Documentation</h2>
<p><a href="http://wix.github.io/openapi-node/">Read the docs</a> and take a look at our Mocha tests to learn more ways to use the library.</p>
<h2>Quick Start</h2>
<pre><code class="lang-js">var express = require('express');
var app = express();
var wix = require('openapi-node');

var APP_ID = 'YOUR_APP_KEY';
var APP_SECRET = 'YOUR_APP_SECRET_KEY';

// The route should match the app endpoint set during registration
app.get('/', function (req, res) {

    // The GET request to your app endpoint will contain an instance parameter for you to parse
    var instance = req.query.instance;
    var message = 'Instance Not Verified';

    try {
        // Parse the instance parameter
        var wixInstance = wix.getConnect().parseInstance(instance, APP_SECRET);
        var instanceId = wixInstance.instanceId;

        // Get a shortcut for the Wix RESTful API
        wixAPI = wix.getAPI(APP_SECRET, APP_ID, instanceId);

        console.log(&quot;Once you've reached this point you're good to use the Wix API, otherwise an exception will be thrown.&quot;);

        message = 'Instance verified';
        res.send( message );

    } catch(e) {
        message = &quot;Wix API init failed. Check your app key, secret and instance Id&lt;br&gt;&quot; + e.message;
        console.log( message );
        res.send( message );
    }

});

app.listen(3000);</code></pre>
<p><strong>Note</strong> Remember to add <code>Wix.js</code> to you HTML files to avoid dismissal. See <a href="http://dev.wix.com/docs/display/DRAF/JavaScript+SDK">JavaScript SDK</a></p>
<h2>Examples</h2>
<h3>Using the authentication module as middleware</h3>
<pre><code class="lang-js">var express = require('express');
var routes = require('./routes');
var Authentication = require('./authentication.js');
var app = express();

function authenticate(req, res, next) {
    var authentication = new Authentication();
    authentication.authenticate(req, res, next);
}

app.get('/widget', authenticate, routes.widget);
app.get('/settings', authenticate, routes.settings);
app.post('/app/settingsupdate', authenticate, routes.settingsupdate);</code></pre>
<h3>Working with the Contact Object</h3>
<h4>Create a Contact and post it to the Wix Hive</h4>
<p>The newContact function returns a new Contact object.</p>
<p>The Contact created is only known locally, it has not been saved to the Wix Hive and does not have an ID.</p>
<p>To share your Contact with the Wix Hive, use the create function as shown below.</p>
<pre><code class="lang-js">// Create a new Contact object.
// This Contact is only known locally at this point, it has not been saved to the Wix Hive.
var contact = api.Contacts.newContact(api);
contact.name({first: 'Karen', last: 'Meep'});
contact.company({role: 'SDK Product', name: 'Wix'});
contact.picture('http://www.mypicture.com');
contact.addEmail({tag: 'work', email: 'karenc@wix.com', emailStatus: api.Contacts.EMAIL_STATUS_TYPES.RECURRING});
contact.addPhone({ tag: 'work', phone: '+1-415-555-5555'});
contact.addAddress(
    {
        tag: 'work',
        address: '500 Terry A Francois',
        city: 'San Francisco',
        region: 'CA',
        country: 'USA',
        postalCode: 94158
    });
contact.addDate({ tag: 'some date', date: '1994-11-05T13:15:30Z'});
contact.addUrl({ tag: 'Dev Center', url: 'http://dev.wix.com/'});

// Save this Contact to the Hive
api.Contacts.create(contact).then(
    function (contactId) {

        // The Contact now exists in the Wix Hive. It has an ID which can be used to query it.
        console.log('Your Contact has been saved, its ID is: '+ contactId);
    },
    function (error) {
        throw error;
    }
);</code></pre>
<h4>Get a Contact from The Wix Hive</h4>
<p>Use this function to get an existing Contact from the Wix Hive</p>
<pre><code class="lang-js">api.Contacts.getContactById('SOME_CONTACT_ID').then(
    function(contact){

        // Do stuff with this Contact
    },
    function(error){
        throw(error);
    }
);</code></pre>
<h4>Updating a Contact's properties</h4>
<p>To explicitly and immediately update Contact information use the Contact.update<propertyName> methods.</p>
<p>These methods make an HTTP PUT call to one of the /contacts/{contactId}/<propertyName> endpoints.</p>
<p>The example below shows how to update the name property of a Contact.</p>
<pre><code class="lang-js">api.Contacts.getContactById(contactId).then(
    function (contact) {
        contact.name().prefix('Sir');
        contact.name().first('Mix');
        contact.name().middle('A');
        contact.name().last('Lot');
        contact.name().suffix('The III');

        contact.updateName().then(
            function (contact) {

                // ...
            },
            function (error) {
                throw error;
            }
        );
    },
    function (error) {
        throw error;
    }
);</code></pre>
<h4>Post an activity against a Contact</h4>
<p>The code below posts an Activity against the given Contact.</p>
<p>Note: Use the Activities.postActivity function to post an Activity in no relation to a Contact.</p>
<pre><code class="lang-js">var trackShare = api.Activities.newActivity(api.Activities.TYPES.TRACK_SHARE);
trackShare.withLocationUrl('http://www.wix.com'); // where on the site did this happen?

// Activity Details will appear on the site owner's Feed
trackShare.withActivityDetails('A user shared a song from your site!', 'http://www.twitter.com/linkToTweet');
trackShare.activityInfo =
    {
        artist: { name: 'Sir Mix-a-Lot', id: '111' },
        track: { name: 'Baby Got Back', id: '1' },
        album: { name: 'Mack Daddy', id: '5555' },
        sharedTo: 'TWITTER'
    };

api.Contacts.getContactById(contactId).then(
    function(contact){

        contact.addActivity(activity, api).then(
            function(data){

                var activityId = data.activityId;
                var contactId = data.contactId;
            },
            function(error){
                throw error;
            }
        );
    },
    function(error){
        throw error;
    }
);</code></pre>
<h4>Get Contact Activities</h4>
<p>The code below posts an Activity against the given Contact.</p>
<p>Note: Use the Activities.postActivity function to post an Activity in no relation to a Contact.</p>
<pre><code class="lang-js">contact.getActivities(nextCursor,
    {
        from: date1.toISOString(),
        until: date2.toISOString(),
        activityTypes: [api.Activities.TYPES.ALBUM_FAN.name, api.Activities.TYPES.ALBUM_SHARE.name],
        scope: 'app'
    }
).then(
    function(pagingActivitiesResult){
        var activities = pagingActivitiesResult.results;
        array.forEach(function(activity) {
            // Do something with the activity
        });

        if (pagingActivitiesResult.nextCursor !== 0) {

            // Get more activities using the cursor
            contact.getActivities(pagingActivitiesResult.nextCursor).then(...)
        }
    },
    function(error){
        throw error;
    }
);</code></pre>
<h3>Get a list of Contacts from The Wix Hive</h3>
<pre><code class="lang-js">api.Contacts.getContacts(
    null, // or cursor
    {
        pageSize: 100 // or 25, 50
    }).then(
    function(wixCursor) {

        // Do something with the Contacts
    },
    function(error) {
        throw error;
    }
);</code></pre>
<h3>Get a list of site Activities</h3>
<pre><code class="lang-js">
api.Activities.getActivities(
    null, // supply a cursor
    {
        from: date1.toISOString(), // Filter by date range
        until: date2.toISOString(),
        activityTypes: [api.Activities.TYPES.ALBUM_FAN.name, api.Activities.TYPES.ALBUM_SHARE.name], // Filter by Activity type
        scope: 'app', // or 'site'
        pageSize: 50 // or 25, 100
    }
).then(function(pagingActivitiesResult) {

        // Use the cursor to page through more Activities..

}, function(error) {
    throw error;
});</code></pre>
<h3>Post An Activity</h3>
<h4>Obtain a User Session Token</h4>
<p>This is where the <a href="http://dev.wix.com/docs/display/DRAF/JavaScript+SDK">Javascript SDK</a> comes in to play. Use it to obtain a user session token, then use the token to create an activity on behalf of the user.</p>
<p>Here's an example of how to obtain the session token and then sending it to the NodeJS server</p>
<pre><code class="lang-js">$(&quot;#createActivityButton&quot;).click(function() {
    Wix.Activities.getUserSessionToken(
        function onSuccess(token){
            console.log('got token: ' + token);
            $.get('/createActivity', {token: token}, function(result) {
                alert(result);
            });
        }
    );
});</code></pre>
<h4>Create an Activity Object</h4>
<p>To create an Activity either use our builder (as shown in the Contact Form Activity example below) or use a JSON, following our Activity schemas (as shown in the Ecommerce Purchase Activity example below)</p>
<h5>Create an Activity Using JSON</h5>
<pre><code class="lang-js">var ecommPurchase = api.Activities.newActivity(api.Activities.TYPES.ECOMMERCE_PURCHASE);
var coupon = {total: '1', title: 'Dis'};
var tax = {total: 1, formattedTotal: 1};
var shipping = {total: 1, formattedTotal: 1};
var payment = {total: '1', subtotal: '1', formattedTotal: '1.0', formattedSubtotal: '1.0', currency: 'EUR', coupon: coupon, tax: tax, shipping: shipping};
var media = {thumbnail: 'PIC'};
var item = { id: 1, sku: 'sky', title: 'title', quantity: 1, price: '1', formattedPrice: '1.1', currency: 'EUR', productLink: 'link', weight: '1', formattedWeight: '1.0KG', media: media, variants: [{title: 'title', value: '1'}]};
var shipping_address =
    {
        firstName: 'Wix' , lastName: 'Cool',
        email: 'wix@example.com', phone: '12345566',
        city: 'Bitola', address1: 'Marshal Tito', address2: 'Marshal Tito',
        region: 'Bitola', regionCode: '7000',
        country: 'USA', countryCode: 'US',
        zip: '7000',
        company: 'Wix.com'
    };
var purchase = { cartId: '11111', storeId: '11111', orderId: '11111',
    items: [item],
    payment: payment,
    shippingAddress: shipping_address,
    billingAddress: shipping_address,
    paymentGateway: 'PAYPAL',
    note: 'Note',
    buyerAcceptsMarketing: true };
ecommPurchase.withLocationUrl('http://www.wix.com');
ecommPurchase.withActivityDetails('test', 'http://www.wix.com');
ecommPurchase.activityInfo = purchase;</code></pre>
<h5>Create an Activity Using The Object Builder</h5>
<pre><code class="lang-js">var activity = api.Activities.newActivity(api.Activities.TYPES.CONTACT_FORM);
activity.activityLocationUrl = &quot;http://www.wix.com&quot;;
activity.activityDetails.summary = &quot;test&quot;;
activity.activityDetails.additionalInfoUrl = &quot;http://www.wix.com&quot;;

var cu = activity.contactUpdate;
cu.addEmail(cu.newEmail().withTag(&quot;main&quot;).withEmail(&quot;name@wexample.com&quot;));

cu.name.withFirst(&quot;Your&quot;).withLast(&quot;Customer&quot;);

activity.withLocationUrl(&quot;test.com&quot;).withActivityDetails(&quot;This is a test activity post&quot;, &quot;http://www.test.com&quot;);
var ai = activity.activityInfo;
ai.addField(ai.newField().withName(&quot;email&quot;).withValue(&quot;name@wexample.com&quot;));
ai.addField(ai.newField().withName(&quot;first&quot;).withValue(&quot;Your&quot;));
ai.addField(ai.newField().withName(&quot;first&quot;).withValue(&quot;Your&quot;));
ai.addField(ai.newField().withName(&quot;last&quot;).withValue(&quot;Customer&quot;));</code></pre>
<h5>Post an Activity From Your Server</h5>
<p>Use the session token on your Node server to create an activity an post it to the Wix Hive.
Note: This code posts an Activity without any connection to a Contact. To post an Activity against a Contact use the Contact.addActivity method.</p>
<pre><code class="lang-js">api.Activities.postActivity(activity, SESSION_ID)
    .then(function(data) {
        console.log ('oh YEAAAHHHH!');

    }, function(error) {
        console.log ('oh no!');
    });</code></pre>
<h2>Running the tests</h2>
<ol>
<li>Install <a href="http://gruntjs.com/installing-grunt">Grunt</a></li>
<li>Run<pre><code class="lang-js">$ grunt schemas</code></pre>
</li>
<li>Install <a href="https://www.npmjs.org/package/mocha">Mocha</a> (-g)</li>
<li>Run the tests using Mocha (use '-R nyan' for fun!)</li>
</ol>
<h2>Questions?</h2>
<p>Explore the complete <a href="http://dev.wix.com/docs/display/DRAF/Working+with+the+Wix+RESTful+API">documentation</a></p></article>
    </section>







				</div>

				<div class="clearfix"></div>
				<footer>
					
					<a href='http://dev.wix.com'>Wix Developer Center</a>
					<br />
					
					
		<span class="copyright">
		2014, Wix
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Sat Nov 08 2014 11:46:19 GMT-0000 (GMT) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<div class="span3">
				<div id="toc"></div>
			</div>
			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:false,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>